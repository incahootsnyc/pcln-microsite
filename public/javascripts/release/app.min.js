!function(){var e=$("#hamburger-icon"),n=$("#navbar-mobile"),i=!0;window.onresize=function(){var a=document.documentElement.clientWidth;a>840?(e.css("display","none").attr("src","images/hamburger.png"),n.css("display","none").removeClass("slideInAnimation"),i=!0):(e.css("display","block"),n.css("display","block"))},e.click(function(){i?(n.addClass("slideInAnimation"),e.attr("src","images/menu-close.png"),i=!i):(n.removeClass("slideInAnimation"),e.attr("src","images/hamburger.png"),i=!i)})}(),function(){var e=window.ontouchstart||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0;if(e)try{for(var n in document.styleSheets){var i=document.styleSheets[n];if(i.rules)for(var a=i.rules.length-1;a>=0;a--)i.rules[a].selectorText&&i.rules[a].selectorText.match(":hover")&&i.deleteRule(a)}}catch(e){}pclnPicMe.supportsDragAndDrop=function(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&"FormData"in window&&"FileReader"in window}(),pclnPicMe.updateQueryStringParameter=function(e,n,i){var a=new RegExp("([?&])"+n+"=.*?(&|$)","i"),t=e.indexOf("?")!==-1?"&":"?";return e.match(a)?e.replace(a,"$1"+n+"="+i+"$2"):e+t+n+"="+i},pclnPicMe.getParameterByName=function(e){var n=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return n&&decodeURIComponent(n[1].replace(/\+/g," "))},pclnPicMe.isValidForm=function(e,n,i,a,t){var o=[],d=!1;for(var r in i)if("map"!=r){var l=n.get(r),s=i[r](l);s&&o.push(s)}return d=0==o.length,t?i.map.forEach(function(e){o.indexOf(e)>-1?$(e).removeClass("ishidden"):$(e).addClass("ishidden")}):i.map.forEach(function(e){o.indexOf(e)<0&&$(e).addClass("ishidden")}),e.find('button[type="submit"]').toggleClass("disabled",!d),d},pclnPicMe.updateLocalLikes=function(e,n,i){var a=this.resultset.find(function(n){return n.uniqueName==e}),t=$('img[data-id="'+e+'"').parent();a.likesCount=n.likes.length,a.likes=n.likes,i&&(t.find(".like-value").text(n.likes.length),pclnPicMe.setLike($(".modal--details__icon-container"),null,n.hasLiked)),pclnPicMe.setLike(t.find(".submissions__icon-container"),null,n.hasLiked)},pclnPicMe.setLike=function(e,n,i){var a=n?n.likes.indexOf(pclnPicMe.uid)>-1:i;a?e.addClass("isliked"):e.removeClass("isliked")},pclnPicMe.lazyLoad=function(e){function n(e,n){var a=i[n],t=new Image;t.onload=function(){var e=this;a.className+=" fade-in-on-load",a.src=e.src},t.src=e.thumbUrl}for(var i=$(".submissions__img"),a=$(".submissions__icon-container"),t=e||0;t<pclnPicMe.resultset.length;t++)n(pclnPicMe.resultset[t],t),pclnPicMe.setLike($(a[t]),pclnPicMe.resultset[t])},pclnPicMe.resultset&&setTimeout(function(){pclnPicMe.lazyLoad()},1e3)}(),pclnPicMe.likesEventHandler=function(){function e(e){e.find(".modal--details__like-content img").click(function(){var i=e.find(".modal--details__container").attr("data-id");n(i,e.find(".details--modal__like-count"),!0)})}function n(e,n,i){var a={url:"/api/like/"+e,type:"GET",success:function(a){a.message||(n.text(a.likes.length),pclnPicMe.updateLocalLikes(e,a,i))}};$.ajax(a)}return $("#image-list").on("click",".submissions__icon-container",function(){var e=$(this),i=e.closest(".submissions__img-container").find(".submissions__img").attr("data-id");n(i,e.siblings(".like-value"))}),{addLikeEvent:e}}(),pclnPicMe.uploadEventHandler=function(){function e(e,n){var i=e.find("form"),a=i.find('input[type="file"]'),t=!1,o=n.find(".modal--sm__button--confirm"),s=n.find(".modal--sm__button--cancel"),c=n.find(".modal__close");i.submit(function(u){u.preventDefault();var p=new FormData(this);return p.append("datetime",Date.now()),r&&p.append(a.attr("name"),r),!!pclnPicMe.isValidForm(i,p,l,r,!0)&&(e.hide(),o.click(function(){if(!t){var e=$(this).find(".loader--white");e.removeClass("ishidden"),t=!0;var a={url:"/api/upload",type:"POST",data:p,contentType:!1,processData:!1,success:function(a){t=!1,a.error?(alert(a.error),d(i),e.addClass("ishidden"),n.hide()):window.location.href="/"},error:function(){t=!1,d(i),e.addClass("ishidden"),n.hide()}};$.ajax(a)}}),s.click(function(){e.show(),n.hide()}),c.click(function(){e.show(),n.hide()}),n.show(),!1)})}function n(e){var n=e.find(".drag-n-drop");n.on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("dragover dragenter",function(){e.addClass("is-dragover")}).on("dragleave dragend drop",function(){e.removeClass("is-dragover")}).on("drop",a(e))}function i(e){var n=e.find("#file");n.change(a(e))}function a(e){function n(n){var i,a=n.originalEvent.dataTransfer;a?(r=n.originalEvent.dataTransfer.files[0],i=r,e.find("#file").val(""),e.trigger("change")):(i=n.currentTarget.files[0],r=!1);var t=new FileReader;t.onload=function(n){e.find("img#preview").attr("src",n.target.result)},t.readAsDataURL(i)}return n}function t(e){var n=e.find("#upload-modal-close");n.click(function(){$("body").css("overflow-y",""),e.hide(),d(e.find("form"))})}function o(e){e.change(function(){var n=new FormData(this);pclnPicMe.isValidForm(e,n,l,r)}),e.find('input[name="location"]').keyup(function(){var n=new FormData(e[0]);pclnPicMe.isValidForm(e,n,l,r)})}function d(e){e[0].reset(),e.find("img#preview").attr("src",""),e.find('button[type="submit"]').addClass("disabled"),e.parent().find(".modal--lg__error-message").addClass("ishidden"),r=!1}var r=!1,l={map:["#image-error","#category-error","#location-error"],image:function(e){if(!(e&&e.size>0||r))return this.map[0]},"category[]":function(e){if(!(e&&e.length>0))return this.map[1]},location:function(e){if(!(e&&e.length>0))return this.map[2]}};return{addSubmitEvent:e,addDragAndDropCapabilities:n,addImagePreviewEvent:i,addCloseEvent:t,addValidationEvent:o}}(),pclnPicMe.updateEventHandler=function(){function e(e){e.submit(function(n){n.preventDefault(),$("<input />").attr("type","hidden").attr("name","uniquename").attr("value",$(this).attr("data-id")).appendTo(this);var i=new FormData(this),a=$(this).serializeArray(),t=$(this).find('button[type="submit"] .loader--white');if(!pclnPicMe.isValidForm(e,i,o,"no-image",!0))return!1;t.removeClass("ishidden");var d={url:"/api/update",type:"POST",data:a,success:function(e){e.error?(alert(e.error),t.addClass("ishidden")):window.location.href="/"}};return $.ajax(d),!1})}function n(e){var n=e.find("#update-modal-close");n.click(function(){$("body").css("overflow-y",""),e.hide()})}function i(e,n,i){var a=e.find(".delete");a.click(function(e){e.preventDefault();var a=n.find(".modal--sm__button--confirm"),t=n.find(".modal--sm__button--cancel"),o=n.find(".modal__close");a.click(function(){var e=$(this).find(".loader--white");e.removeClass("ishidden");var n={url:"/api/remove/"+i.uniqueName,type:"GET",success:function(n){n.error?(alert(n.error),e.addClass("ishidden")):window.location.href="/"}};$.ajax(n)}),t.click(function(){n.hide()}),o.click(function(){n.hide()}),n.show()})}function a(e){e.change(function(){var n=new FormData(this);pclnPicMe.isValidForm(e,n,o,"no-image")})}function t(e,n){var i=e.find("form");i[0].reset(),i.attr("data-id",n.uniqueName),e.find(".modal--lg__img-preview").attr("src",n.thumbUrl),e.find(".modal--lg__input").val(n.location),n.tags.forEach(function(n){e.find("#update-"+n).prop("checked",!0)})}var o={map:["#update-category-error","#update-location-error"],"category[]":function(e){if(!(e&&e.length>0))return this.map[0]},location:function(e){if(!(e&&e.length>0))return this.map[1]}};return{addCloseEvent:n,populateUpdateModal:t,addSubmitEvent:e,addDeleteEvent:i,addValidationEvent:a}}(),pclnPicMe.detailsEventHandler=function(){function e(e){var n=e.find("#details-modal-close");n.click(function(){$("body").css("overflow-y",""),e.hide()})}function n(e){e.find(".modal--details__arrow-right").click(function(){var n=a+1;n<pclnPicMe.resultset.length&&i(e,pclnPicMe.resultset[n]),a=n}),e.find(".modal--details__arrow-left").click(function(){var n=a-1;n>=0&&i(e,pclnPicMe.resultset[n]),a=n})}function i(e,n){var i=e.find(".modal--details__img-categories"),t=e.find(".modal--details__edit"),o=e.find(".modal--details__download");i.empty(),pclnPicMe.setLike(e.find(".modal--details__icon-container"),n),e.find(".modal--details__img").attr("src",n.detailsUrl),e.find(".details--modal__like-count").text(n.likesCount),e.find(".modal--details__container").attr("data-id",n.uniqueName),e.find(".modal--details__img-submitter").text(n.username),e.find(".modal--details__arrow-left").toggleClass("ishidden",0==n.index),e.find(".modal--details__arrow-right").toggleClass("ishidden",n.index==pclnPicMe.resultset.length-1),pclnPicMe.uid!=n.uid?t.hide():t.show(),n.downloadUrl?(o.attr("href",n.downloadUrl),o.show()):o.hide(),n.tags.forEach(function(e){i.append('<span class="modal--details__category">#'+pclnPicMe.tagDictionary[e]+"</span>")}),a=n.index}var a=0;return{addCloseEvent:e,addShiftEvents:n,populateDetailsModal:i}}(),function(){function e(e){e.find(".modal--details__edit").click(function(a){a.preventDefault(),e.hide();var t=$(a.currentTarget),o=$("#update-modal"),d=$("#delete-confirm"),r=pclnPicMe.resultset.find(function(e){return e.uniqueName==t.parents(".modal--details__container").attr("data-id")});if(o.length<1){o=n("update-modal");var l=o.find("form");pclnPicMe.updateEventHandler.addCloseEvent(o),pclnPicMe.updateEventHandler.addSubmitEvent(l),pclnPicMe.updateEventHandler.addValidationEvent(l),d.length<1&&(d=n("delete-confirm")),pclnPicMe.updateEventHandler.addDeleteEvent(l,d,r),i(o,{updateImageData:r})}else i(o,{updateImageData:r})})}function n(e){for(var n=$("template").html().trim(),i=$(n),t=[],o=0;o<i.length;o++)"#text"!=i[o].nodeName&&t.push(i[o]);var d=a[e],r=$(t[d]);return r.appendTo("body")}function i(e,n){n&&n.detailsImageData?pclnPicMe.detailsEventHandler.populateDetailsModal(e,n.detailsImageData):n&&n.updateImageData&&pclnPicMe.updateEventHandler.populateUpdateModal(e,n.updateImageData),$("body").css("overflow-y","hidden"),e.show()}var a={"upload-modal":0,"upload-success":1,"delete-confirm":2,"update-modal":3,"details-modal":4,"accept-terms":5};$("#upload-image").click(function(e){var a=$("#upload-modal");if(a.length<1){a=n("upload-modal");var t=a.find("form"),o=$("#accept-terms");pclnPicMe.supportsDragAndDrop&&pclnPicMe.uploadEventHandler.addDragAndDropCapabilities(t),o.length<1&&(o=n("accept-terms")),pclnPicMe.uploadEventHandler.addCloseEvent(a),pclnPicMe.uploadEventHandler.addImagePreviewEvent(t),pclnPicMe.uploadEventHandler.addSubmitEvent(a,o),pclnPicMe.uploadEventHandler.addValidationEvent(t),i(a)}else i(a)}),$("#delete-image").click(function(e){n("delete-confirm")}),$("#image-list").on("click",".submissions__img",function(){var a=$(this),t=$("#details-modal"),o=pclnPicMe.resultset.find(function(e){return e.uniqueName==a.attr("data-id")});t.length<1?(t=n("details-modal"),pclnPicMe.detailsEventHandler.addCloseEvent(t),pclnPicMe.detailsEventHandler.addShiftEvents(t),pclnPicMe.likesEventHandler.addLikeEvent(t),e(t),i(t,{detailsImageData:o})):i(t,{detailsImageData:o})})}(),function(){function e(){var e,n=pclnPicMe.getParameterByName("tags");$(".sidebar__categories_input").prop("checked",!1),n&&n.length>0&&(e=n.split(","),e.forEach(function(e){var n=$('.sidebar__categories_input[value="'+e+'"]');n.prop("checked",!0),n.next().addClass("checkedtag")}))}e(),$(".submissions__sort").change(function(e){var n=pclnPicMe.updateQueryStringParameter(window.location.href,"sort",$(this).find("option:selected").val());window.location.href=n}),$(".sidebar__categories_input").change(function(){for(var e=$(".sidebar__categories_input:checked"),n=[],i=e.length-1;i>=0;i--)n.push(e[i].value);var a=pclnPicMe.updateQueryStringParameter(window.location.href,"tags",n.join(","));window.location.href=a}),$(".submissions__username a").click(function(e){e.preventDefault();var n=pclnPicMe.updateQueryStringParameter(window.location.href,"user",$(this).text().replace(" ","."));window.location.href=n})}(),function(){function e(e){var n='<li class="submissions__img-container"><img class="submissions__img" data-id="'+e.uniqueName+'" src=""><div class="submission__info"><span class="submissions__username"><a href="">'+e.username+'</a></span><span class="submissions__icon-container"><img class="submissions__like-icon" src="/images/hand.svg"/></span>Likes: <span class="like-value">'+e.likesCount+"</span></span></div></li>";return n}var n=1,i=pageSize=pclnPicMe.pageSize,a=!0,t=!1;$(window).scroll(function(){var o=$(window).scrollTop()+$(window).height()>$(document).height()-200,d="mypics"==pclnPicMe.scrollType,r=window.location.search.length>0?"&uid="+pclnPicMe.uid:"?uid="+pclnPicMe.uid,l="/api/fetchPosts/"+n+window.location.search,s=$(".pageloader");if(o&&a&&!t){d&&(l+=r),s.show();var c={url:l,type:"GET",success:function(o){i=n*pageSize,a=i<o.totalPostCount,t=!1,s.hide(),n++,o.images.length>0&&(pclnPicMe.resultset=pclnPicMe.resultset.concat(o.images),o.images.forEach(function(n){$(e(n)).appendTo("#image-list")}),pclnPicMe.lazyLoad(i))}};t=!0,$.ajax(c)}})}();