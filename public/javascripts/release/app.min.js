(function(){function e(e){return!!e.exifdata}function t(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var n=atob(e),i=n.length,a=new ArrayBuffer(i),r=new Uint8Array(a),o=0;o<i;o++)r[o]=n.charCodeAt(o);return a}function i(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(e){200!=this.status&&0!==this.status||t(this.response)},n.send()}function a(e,n){function a(t){var i=r(t),a=o(t);e.exifdata=i||{},e.iptcdata=a||{},n&&n.call(e)}if(e.src)if(/^data\:/i.test(e.src)){var l=t(e.src);a(l)}else if(/^blob\:/i.test(e.src)){var d=new FileReader;d.onload=function(e){a(e.target.result)},i(e.src,function(e){d.readAsArrayBuffer(e)})}else{var s=new XMLHttpRequest;s.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";a(s.response),s=null},s.open("GET",e.src,!0),s.responseType="arraybuffer",s.send(null)}else if(window.FileReader&&(e instanceof window.Blob||e instanceof window.File)){var d=new FileReader;d.onload=function(e){f&&console.log("Got file of length "+e.target.result.byteLength),a(e.target.result)},d.readAsArrayBuffer(e)}}function r(e){var t=new DataView(e);if(f&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return f&&console.log("Not a valid JPEG"),!1;for(var n,i=2,a=e.byteLength;i<a;){if(255!=t.getUint8(i))return f&&console.log("Not a valid marker at offset "+i+", found: "+t.getUint8(i)),!1;if(n=t.getUint8(i+1),f&&console.log(n),225==n)return f&&console.log("Found 0xFFE1 marker"),u(t,i+4,t.getUint16(i+2)-2);i+=2+t.getUint16(i+2)}}function o(e){var t=new DataView(e);if(f&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return f&&console.log("Not a valid JPEG"),!1;for(var n=2,i=e.byteLength,a=function(e,t){return 56===e.getUint8(t)&&66===e.getUint8(t+1)&&73===e.getUint8(t+2)&&77===e.getUint8(t+3)&&4===e.getUint8(t+4)&&4===e.getUint8(t+5)};n<i;){if(a(t,n)){var r=t.getUint8(n+7);r%2!==0&&(r+=1),0===r&&(r=4);var o=n+8+r,d=t.getUint16(n+6+r);return l(e,o,d)}n++}}function l(e,t,n){for(var i,a,r,o,l,d=new DataView(e),s={},u=t;u<t+n;)28===d.getUint8(u)&&2===d.getUint8(u+1)&&(o=d.getUint8(u+2),o in w&&(r=d.getInt16(u+3),l=r+5,a=w[o],i=c(d,u+5,r),s.hasOwnProperty(a)?s[a]instanceof Array?s[a].push(i):s[a]=[s[a],i]:s[a]=i)),u++;return s}function d(e,t,n,i,a){var r,o,l,d=e.getUint16(n,!a),c={};for(l=0;l<d;l++)r=n+12*l+2,o=i[e.getUint16(r,!a)],!o&&f&&console.log("Unknown tag: "+e.getUint16(r,!a)),c[o]=s(e,r,t,n,a);return c}function s(e,t,n,i,a){var r,o,l,d,s,u,f=e.getUint16(t+2,!a),g=e.getUint32(t+4,!a),p=e.getUint32(t+8,!a)+n;switch(f){case 1:case 7:if(1==g)return e.getUint8(t+8,!a);for(r=g>4?p:t+8,o=[],d=0;d<g;d++)o[d]=e.getUint8(r+d);return o;case 2:return r=g>4?p:t+8,c(e,r,g-1);case 3:if(1==g)return e.getUint16(t+8,!a);for(r=g>2?p:t+8,o=[],d=0;d<g;d++)o[d]=e.getUint16(r+2*d,!a);return o;case 4:if(1==g)return e.getUint32(t+8,!a);for(o=[],d=0;d<g;d++)o[d]=e.getUint32(p+4*d,!a);return o;case 5:if(1==g)return s=e.getUint32(p,!a),u=e.getUint32(p+4,!a),l=new Number(s/u),l.numerator=s,l.denominator=u,l;for(o=[],d=0;d<g;d++)s=e.getUint32(p+8*d,!a),u=e.getUint32(p+4+8*d,!a),o[d]=new Number(s/u),o[d].numerator=s,o[d].denominator=u;return o;case 9:if(1==g)return e.getInt32(t+8,!a);for(o=[],d=0;d<g;d++)o[d]=e.getInt32(p+4*d,!a);return o;case 10:if(1==g)return e.getInt32(p,!a)/e.getInt32(p+4,!a);for(o=[],d=0;d<g;d++)o[d]=e.getInt32(p+8*d,!a)/e.getInt32(p+4+8*d,!a);return o}}function c(e,t,i){var a="";for(n=t;n<t+i;n++)a+=String.fromCharCode(e.getUint8(n));return a}function u(e,t){if("Exif"!=c(e,t,4))return f&&console.log("Not valid EXIF data! "+c(e,t,4)),!1;var n,i,a,r,o,l=t+6;if(18761==e.getUint16(l))n=!1;else{if(19789!=e.getUint16(l))return f&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;n=!0}if(42!=e.getUint16(l+2,!n))return f&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var s=e.getUint32(l+4,!n);if(s<8)return f&&console.log("Not valid TIFF data! (First offset less than 8)",e.getUint32(l+4,!n)),!1;if(i=d(e,l,l+s,h,n),i.ExifIFDPointer){r=d(e,l,l+i.ExifIFDPointer,m,n);for(a in r){switch(a){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":r[a]=P[a][r[a]];break;case"ExifVersion":case"FlashpixVersion":r[a]=String.fromCharCode(r[a][0],r[a][1],r[a][2],r[a][3]);break;case"ComponentsConfiguration":r[a]=P.Components[r[a][0]]+P.Components[r[a][1]]+P.Components[r[a][2]]+P.Components[r[a][3]]}i[a]=r[a]}}if(i.GPSInfoIFDPointer){o=d(e,l,l+i.GPSInfoIFDPointer,v,n);for(a in o){switch(a){case"GPSVersionID":o[a]=o[a][0]+"."+o[a][1]+"."+o[a][2]+"."+o[a][3]}i[a]=o[a]}}return i}var f=!1,g=this,p=function(e){return e instanceof p?e:this instanceof p?void(this.EXIFwrapped=e):new p(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports.EXIF=p):g.EXIF=p;var m=p.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},h=p.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},v=p.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},P=p.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},w={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};p.getData=function(t,n){return!((t instanceof Image||t instanceof HTMLImageElement)&&!t.complete)&&(e(t)?n&&n.call(t):a(t,n),!0)},p.getTag=function(t,n){if(e(t))return t.exifdata[n]},p.getAllTags=function(t){if(!e(t))return{};var n,i=t.exifdata,a={};for(n in i)i.hasOwnProperty(n)&&(a[n]=i[n]);return a},p.pretty=function(t){if(!e(t))return"";var n,i=t.exifdata,a="";for(n in i)i.hasOwnProperty(n)&&(a+="object"==typeof i[n]?i[n]instanceof Number?n+" : "+i[n]+" ["+i[n].numerator+"/"+i[n].denominator+"]\r\n":n+" : ["+i[n].length+" values]\r\n":n+" : "+i[n]+"\r\n");return a},p.readFromBinaryFile=function(e){return r(e)},"function"==typeof define&&define.amd&&define("exif-js",[],function(){return p})}).call(this),function(){var e=$("#hamburger-icon"),t=$("#navbar-mobile"),n=!0;window.onresize=function(){var i=document.documentElement.clientWidth;i>840?(e.css("display","none").attr("src","images/hamburger.png"),t.css("display","none").removeClass("slideInAnimation"),n=!0):(e.css("display","block"),t.css("display","block"))},e.click(function(){n?(t.addClass("slideInAnimation"),e.attr("src","images/menu-close.png"),n=!n):(t.removeClass("slideInAnimation"),e.attr("src","images/hamburger.png"),n=!n)})}(),function(){pclnPicMe.supportsDragAndDrop=function(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&"FormData"in window&&"FileReader"in window}(),pclnPicMe.updateQueryStringParameter=function(e,t,n){var i=new RegExp("([?&])"+t+"=.*?(&|$)","i"),a=e.indexOf("?")!==-1?"&":"?";return e.match(i)?e.replace(i,"$1"+t+"="+n+"$2"):e+a+t+"="+n},pclnPicMe.redirectHome=function(){window.location.href="/home"+window.location.search},pclnPicMe.getParameterByName=function(e){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))},pclnPicMe.isValidForm=function(e,t,n,i){var a=[],r=!1;for(var o in t)if("map"!=o){var l;l="category[]"==o?e.find('input[name="'+o+'"]:checked').val():e.find('input[name="'+o+'"]').val();var d=t[o](l);d&&a.push(d)}return r=0==a.length,i?t.map.forEach(function(e){a.indexOf(e)>-1?$(e).removeClass("ishidden"):$(e).addClass("ishidden")}):t.map.forEach(function(e){a.indexOf(e)<0&&$(e).addClass("ishidden")}),e.find('button[type="submit"]').toggleClass("disabled",!r),r},pclnPicMe.unbindClickEvents=function(e){e.forEach(function(e){e.unbind("click")})},pclnPicMe.updateLocalLikes=function(e,t,n){var i=this.resultset.find(function(t){return t.uniqueName==e}),a=$('img[data-id="'+e+'"]').parent();i.likesCount=t.likes.length,i.likes=t.likes,n&&(a.find(".like-value").text(t.likes.length),pclnPicMe.setLike($(".modal--details__icon-container"),null,t.hasLiked)),pclnPicMe.setLike(a.find(".submissions__icon-container"),null,t.hasLiked)},pclnPicMe.setLike=function(e,t,n){var i=t?t.likes.indexOf(pclnPicMe.uid)>-1:n;i?e.addClass("isliked"):e.removeClass("isliked")},pclnPicMe.lazyLoad=function(e){function t(e,t){var i=n[t],a=new Image;a.onload=function(){var e=this;i.className+=" fade-in-on-load",i.src=e.src},a.src=e.thumbUrl}for(var n=$(".submissions__img"),i=$(".submissions__icon-container"),a=e||0;a<pclnPicMe.resultset.length;a++)t(pclnPicMe.resultset[a],a),pclnPicMe.setLike($(i[a]),pclnPicMe.resultset[a])},pclnPicMe.resultset&&setTimeout(function(){pclnPicMe.lazyLoad()},1e3)}(),pclnPicMe.likesEventHandler=function(){function e(e){e.find(".modal--details__like-content img").click(function(){var n=e.find(".modal--details__container").attr("data-id");t(n,e.find(".details--modal__like-count"),!0)})}function t(e,t,n){var i={url:"/api/like/"+e,type:"GET",success:function(i){i.message||(t.text(i.likes.length),pclnPicMe.updateLocalLikes(e,i,n))}};$.ajax(i)}return $("#image-list").on("click",".submissions__icon-container",function(){var e=$(this),n=e.closest(".submissions__img-container").find(".submissions__img").attr("data-id");t(n,e.siblings(".like-value"))}),{addLikeEvent:e}}(),pclnPicMe.uploadEventHandler=function(){function e(e,t){var n=e.find("form"),i=n.find('input[type="file"]'),a=t.find(".modal--sm__button--confirm"),r=t.find("#terms-link"),o=t.find(".modal--sm__button--cancel"),l=t.find(".modal__close"),d=!1;n.submit(function(s){s.preventDefault(),pclnPicMe.unbindClickEvents([a,o,l,r,t]);var g=new FormData(this);return g.append("datetime",Date.now()),c&&(u?g.append(i.attr("name"),c,u):g.append(i.attr("name"),c)),!!pclnPicMe.isValidForm(n,f,c,!0)&&(e.hide(),a.click(function(){if(!d){var n=$(this).find(".loader--white");n.removeClass("ishidden"),d=!0;var i={url:"/api/upload",type:"POST",data:g,contentType:!1,processData:!1,success:function(i){d=!1,i.error?(alert(i.error),e.find("#upload-modal-close").trigger("click"),n.addClass("ishidden"),t.hide()):pclnPicMe.redirectHome()},error:function(){d=!1,e.find("#upload-modal-close").trigger("click"),n.addClass("ishidden"),t.hide()}};$.ajax(i)}}),r.click(function(e){e.preventDefault(),t.find(".modal--smal__text").toggle()}),o.click(function(){e.show(),t.hide()}),l.click(function(){e.show(),t.hide()}),t.click(function(n){var i=$(n.target);i.is(".modal-overlay")&&(e.show(),t.hide())}),t.find(".modal--smal__text").hide(),t.show(),!1)})}function t(e){var t=e.find(".drag-n-drop");t.on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("dragover dragenter",function(){e.addClass("is-dragover")}).on("dragleave dragend drop",function(){e.removeClass("is-dragover")}).on("drop",i(e)),t.click(function(){e.find("#file").trigger("click")})}function n(e){var t=e.find("#file");t.change(i(e))}function i(e){function t(t){var n,i=t.originalEvent.dataTransfer;i?(c=t.originalEvent.dataTransfer.files[0],n=c,u=void 0,e.find("#file").val(""),e.trigger("change")):(n=t.currentTarget.files[0],c=!1),EXIF.getData(n,function(){var t=new Image,i=new Image(140,140),a=e.find("img#preview")[0],r=EXIF.getTag(this,"Orientation"),o=document.createElement("canvas"),s=document.createElement("canvas"),f=o.getContext("2d"),g=s.getContext("2d"),p=window.URL||window.webkitURL,m=p.createObjectURL(n);if(r)e.find(".modal--lg__dragbox-cloud.rolling").removeClass("ishidden"),e.find(".modal--lg__dragbox-cloud.default").hide(),t.onload=function(){var n=d(t,r,s,g);u=e.find("#file").val().trim().length>0?e.find("#file").val():"image.jpeg",e.find("#file").val(""),c=l(n)},i.onload=function(){var t=d(i,r,o,f);a.src=t,e.find(".modal--lg__dragbox-cloud.rolling").addClass("ishidden"),e.find(".modal--lg__dragbox-cloud.default").show()},t.src=m,i.src=m;else{var h=new FileReader;h.onload=function(t){e.find("img#preview").attr("src",t.target.result)},h.readAsDataURL(n)}})}return t}function a(e){function t(){$("body").css("overflow-y",""),e.hide(),o(e.find("form"))}var n=e.find("#upload-modal-close");n.click(t),e.click(function(e){var n=$(e.target);n.is(".modal-overlay")&&t()})}function r(e){e.change(function(){pclnPicMe.isValidForm(e,f,c)}),e.find('input[name="location"]').keyup(function(){pclnPicMe.isValidForm(e,f,c)})}function o(e){e[0].reset(),e.find("img#preview").attr("src",""),e.find('button[type="submit"]').addClass("disabled"),e.parent().find(".modal--lg__error-message").addClass("ishidden"),u=void 0,c=!1}function l(e){var t,n;t=e.split(",")[0].indexOf("base64")!==-1?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0];for(var i=new Array,a=0;a<t.length;a++)i[a]=t.charCodeAt(a);return new Blob([new Uint8Array(i)],{type:n})}function d(e,t,n,i){if(e.width>140){var a=s(e.width,e.height,2048,2048);e.width=a.width,e.height=a.height}n.width=e.width,n.height=e.height,i.save();var r=n.width,o=n.style.width,l=n.height,d=n.style.height;switch(t>4&&(n.width=l,n.style.width=d,n.height=r,n.style.height=o),t){case 2:i.translate(r,0),i.scale(-1,1);break;case 3:i.translate(r,l),i.rotate(Math.PI);break;case 4:i.translate(0,l),i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI),i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI),i.translate(0,-l);break;case 7:i.rotate(.5*Math.PI),i.translate(r,-l),i.scale(-1,1);break;case 8:i.rotate(-.5*Math.PI),i.translate(-r,0)}return i.drawImage(e,0,0,e.width,e.height),i.restore(),n.toDataURL("image/jpeg",1)}function s(e,t,n,i){var a=Math.min(n/e,i/t);return{width:e*a,height:t*a}}var c=!1,u=void 0,f={map:["#image-error","#category-error","#location-error"],image:function(e){if(!(e&&e.length>0||c))return this.map[0]},"category[]":function(e){if(!(e&&e.length>0))return this.map[1]},location:function(e){if(!(e&&e.length>0))return this.map[2]}};return{addSubmitEvent:e,addDragAndDropCapabilities:t,addImagePreviewEvent:n,addCloseEvent:a,addValidationEvent:r}}(),pclnPicMe.updateEventHandler=function(){function e(e){e.submit(function(t){t.preventDefault(),$("<input />").attr("type","hidden").attr("name","uniquename").attr("value",$(this).attr("data-id")).appendTo(this);var n=(new FormData(this),$(this).serializeArray()),i=$(this).find('button[type="submit"] .loader--white');if(!pclnPicMe.isValidForm(e,r,"no-image",!0))return!1;i.removeClass("ishidden");var a={url:"/api/update",type:"POST",data:n,success:function(e){e.error?(alert(e.error),i.addClass("ishidden")):pclnPicMe.redirectHome()}};return $.ajax(a),!1})}function t(e){function t(){$("body").css("overflow-y",""),e.hide()}var n=e.find("#update-modal-close");n.click(t),e.click(function(e){var n=$(e.target);n.is(".modal-overlay")&&t()})}function n(e,t){var n=e.find(".delete"),i=t.find(".modal--sm__button--confirm"),a=t.find(".modal--sm__button--cancel"),r=t.find(".modal__close");n.click(function(e){e.preventDefault(),pclnPicMe.unbindClickEvents([i,a,r,t]),i.click(function(){var e=$(this).find(".loader--white");e.removeClass("ishidden");var t={url:"/api/remove/"+o.uniqueName,type:"GET",success:function(t){t.error?(alert(t.error),e.addClass("ishidden")):pclnPicMe.redirectHome()}};$.ajax(t)}),a.click(function(){t.hide()}),r.click(function(){t.hide()}),t.click(function(e){var n=$(e.target);n.is(".modal-overlay")&&t.hide()}),t.show()})}function i(e){e.change(function(){pclnPicMe.isValidForm(e,r,"no-image")})}function a(e,t){var n=e.find("form");o=t,n[0].reset(),n.attr("data-id",o.uniqueName),e.find(".modal--lg__img-preview").attr("src",o.thumbUrl),e.find(".modal--lg__input").val(o.location),o.tags.forEach(function(t){e.find("#update-"+t).prop("checked",!0)})}var r={map:["#update-category-error","#update-location-error"],"category[]":function(e){if(!(e&&e.length>0))return this.map[0]},location:function(e){if(!(e&&e.length>0))return this.map[1]}},o={};return{addCloseEvent:t,populateUpdateModal:a,addSubmitEvent:e,addDeleteEvent:n,addValidationEvent:i}}(),pclnPicMe.detailsEventHandler=function(){function e(e){function t(){$("body").css("overflow-y",""),e.hide()}var n=e.find("#details-modal-close");n.click(t),e.click(function(e){var n=$(e.target);n.is(".modal-overlay")&&t()})}function t(e){e.find(".modal--details__arrow-right").click(function(){var t=i+1;t<pclnPicMe.resultset.length&&n(e,pclnPicMe.resultset[t]),i=t}),e.find(".modal--details__arrow-left").click(function(){var t=i-1;t>=0&&n(e,pclnPicMe.resultset[t]),i=t})}function n(e,t){var n=e.find(".modal--details__img-categories"),a=e.find(".modal--details__edit"),r=e.find(".modal--details__download");n.empty(),pclnPicMe.setLike(e.find(".modal--details__icon-container"),t),e.find(".modal--details__img").attr("src",t.detailsUrl),e.find(".details--modal__like-count").text(t.likesCount),e.find(".modal--details__container").attr("data-id",t.uniqueName),e.find(".modal--details__img-submitter").text(t.username),e.find(".modal--details__arrow-left").toggleClass("ishidden",0==t.index),e.find(".modal--details__arrow-right").toggleClass("ishidden",t.index==pclnPicMe.resultset.length-1),pclnPicMe.uid==t.uid||t.downloadUrl?t.downloadUrl&&a.show():a.hide(),t.downloadUrl?(r.attr("href",t.downloadUrl),r.show()):r.hide(),t.tags.forEach(function(e){n.append('<span class="modal--details__category">#'+pclnPicMe.tagDictionary[e]+"</span>")}),i=t.index}var i=0;return{addCloseEvent:e,addShiftEvents:t,populateDetailsModal:n}}(),function(){function e(e){e.find(".modal--details__edit").click(function(i){i.preventDefault(),e.hide();var a=$(i.currentTarget),r=$("#update-modal"),o=$("#delete-confirm"),l=pclnPicMe.resultset.find(function(e){return e.uniqueName==a.parents(".modal--details__container").attr("data-id")});if(r.length<1){r=t("update-modal");var d=r.find("form");pclnPicMe.updateEventHandler.addCloseEvent(r),pclnPicMe.updateEventHandler.addSubmitEvent(d),pclnPicMe.updateEventHandler.addValidationEvent(d),o.length<1&&(o=t("delete-confirm")),pclnPicMe.updateEventHandler.addDeleteEvent(d,o),n(r,{updateImageData:l})}else n(r,{updateImageData:l})})}function t(e){for(var t=$("template").html().trim(),n=$(t),a=[],r=0;r<n.length;r++)"#text"!=n[r].nodeName&&a.push(n[r]);var o=i[e],l=$(a[o]);return l.appendTo("body")}function n(e,t){t&&t.detailsImageData?pclnPicMe.detailsEventHandler.populateDetailsModal(e,t.detailsImageData):t&&t.updateImageData&&pclnPicMe.updateEventHandler.populateUpdateModal(e,t.updateImageData),$("body").css("overflow-y","hidden"),e.show()}var i={"upload-modal":0,"upload-success":1,"delete-confirm":2,"update-modal":3,"details-modal":4,"accept-terms":5};$("#upload-image").click(function(e){var i=$("#upload-modal");if(i.length<1){i=t("upload-modal");var a=i.find("form"),r=$("#accept-terms");pclnPicMe.supportsDragAndDrop&&pclnPicMe.uploadEventHandler.addDragAndDropCapabilities(a),r.length<1&&(r=t("accept-terms")),pclnPicMe.uploadEventHandler.addCloseEvent(i),pclnPicMe.uploadEventHandler.addImagePreviewEvent(a),pclnPicMe.uploadEventHandler.addSubmitEvent(i,r),pclnPicMe.uploadEventHandler.addValidationEvent(a),n(i)}else n(i)}),$("#delete-image").click(function(e){t("delete-confirm")}),$("#image-list").on("click",".submissions__img",function(){var i=$(this),a=$("#details-modal"),r=pclnPicMe.resultset.find(function(e){return e.uniqueName==i.attr("data-id")});a.length<1?(a=t("details-modal"),pclnPicMe.detailsEventHandler.addCloseEvent(a),pclnPicMe.detailsEventHandler.addShiftEvents(a),pclnPicMe.likesEventHandler.addLikeEvent(a),e(a),n(a,{detailsImageData:r})):n(a,{detailsImageData:r})})}(),function(){function e(){var e=pclnPicMe.getParameterByName("tag")||"all",t=$('.sidebar__categories_input[name="user"]');if($(".sidebar__categories_input").prop("checked",!1),e&&e.trim().length>0&&t.length<1){var n=$('.sidebar__categories_input[value="'+e+'"]');n.prop("checked",!0),n.next().addClass("checkedtag"),$(".main-filters-list").append("<span>: "+n.next().text().replace("#","")+"</span>")}else t.length>0&&(t.prop("checked",!0),t.next().addClass("checkedtag"),$(".main-filters-list").append("<span>: "+t.val().replace("."," ")+"</span>"))}e(),$(".submissions__sort").change(function(e){var t=pclnPicMe.updateQueryStringParameter(window.location.href,"sort",$(this).find("option:selected").val());window.location.href=t}),$(".sidebar__categories_input").change(function(){var e,t=$('.sidebar__categories_input[name="category[]"]:checked'),n=pclnPicMe.updateQueryStringParameter(window.location.href,"tag",t.val());e=n.indexOf("user")>-1?pclnPicMe.updateQueryStringParameter(n,"user",""):n,window.location.href=e}),$(".submissions__username a").click(function(e){e.preventDefault();var t,n=pclnPicMe.updateQueryStringParameter(window.location.href,"user",$(this).text().replace(" ","."));t=n.indexOf("tag")>-1?pclnPicMe.updateQueryStringParameter(n,"tag",""):n,window.location.href=t})}(),function(){function e(e){var t='<li class="submissions__img-container data-uid="'+e.uid+'"><img class="submissions__img" data-id="'+e.uniqueName+'" src=""><div class="submission__info"><span class="submissions__username"><a href="">'+e.username+'</a></span><span class="submissions__icon-container"><img class="submissions__like-icon" src="/images/hand.svg"/></span>Likes: <span class="like-value">'+e.likesCount+"</span></span></div></li>";return t}var t=1,n=pageSize=pclnPicMe.pageSize,i=!0,a=!1;$(window).scroll(function(){var r=$(window).scrollTop()+$(window).height()>$(document).height()-200,o="mypics"==pclnPicMe.scrollType,l=window.location.search.length>0?"&uid="+pclnPicMe.uid:"?uid="+pclnPicMe.uid,d="/api/fetchPosts/"+t+window.location.search,s=$(".pageloader");if(r&&i&&!a){o&&(d+=l),s.show();var c={url:d,type:"GET",success:function(r){n=t*pageSize,i=n<r.totalPostCount,a=!1,s.hide(),t++,r.images.length>0&&(pclnPicMe.resultset=pclnPicMe.resultset.concat(r.images),r.images.forEach(function(t){$(e(t)).appendTo("#image-list")}),pclnPicMe.lazyLoad(n))}};a=!0,$.ajax(c)}})}();