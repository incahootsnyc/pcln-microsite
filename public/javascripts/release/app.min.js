!function(){var e=$("#hamburger-icon"),n=$("#navbar-mobile"),i=!0;window.onresize=function(){var a=document.documentElement.clientWidth;a>840?(e.css("display","none").attr("src","images/hamburger.png"),n.css("display","none").removeClass("slideInAnimation"),i=!0):(e.css("display","block"),n.css("display","block"))},e.click(function(){i?(n.addClass("slideInAnimation"),e.attr("src","images/menu-close.png"),i=!i):(n.removeClass("slideInAnimation"),e.attr("src","images/hamburger.png"),i=!i)})}(),function(){pclnPicMe.supportsDragAndDrop=function(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&"FormData"in window&&"FileReader"in window}(),pclnPicMe.updateQueryStringParameter=function(e,n,i){var a=new RegExp("([?&])"+n+"=.*?(&|$)","i"),t=e.indexOf("?")!==-1?"&":"?";return e.match(a)?e.replace(a,"$1"+n+"="+i+"$2"):e+t+n+"="+i},pclnPicMe.redirectHome=function(){window.location.href="/home"+window.location.search},pclnPicMe.getParameterByName=function(e){var n=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return n&&decodeURIComponent(n[1].replace(/\+/g," "))},pclnPicMe.isValidForm=function(e,n,i,a){var t=[],d=!1;for(var l in n)if("map"!=l){var o;o="category[]"==l?e.find('input[name="'+l+'"]:checked').val():e.find('input[name="'+l+'"]').val();var c=n[l](o);c&&t.push(c)}return d=0==t.length,a?n.map.forEach(function(e){t.indexOf(e)>-1?$(e).removeClass("ishidden"):$(e).addClass("ishidden")}):n.map.forEach(function(e){t.indexOf(e)<0&&$(e).addClass("ishidden")}),e.find('button[type="submit"]').toggleClass("disabled",!d),d},pclnPicMe.unbindClickEvents=function(e){e.forEach(function(e){e.unbind("click")})},pclnPicMe.updateLocalLikes=function(e,n,i){var a=this.resultset.find(function(n){return n.id==e}),t=$('img[data-id="'+e+'"').parent();a.likesCount=n.likes.length,a.likes=n.likes,i&&(t.find(".like-value").text(n.likes.length),pclnPicMe.setLike($(".modal--details__icon-container"),null,n.hasLiked)),pclnPicMe.setLike(t.find(".submissions__icon-container"),null,n.hasLiked)},pclnPicMe.setLike=function(e,n,i){var a=n?n.likes.indexOf(pclnPicMe.uid)>-1:i;a?e.addClass("isliked"):e.removeClass("isliked")},pclnPicMe.lazyLoad=function(e){function n(e,n){var a=i[n],t=new Image;t.onload=function(){var e=this;a.className+=" fade-in-on-load",a.src=e.src},t.src=e.thumbUrl}for(var i=$(".submissions__img"),a=$(".submissions__icon-container"),t=e||0;t<pclnPicMe.resultset.length;t++)n(pclnPicMe.resultset[t],t),pclnPicMe.setLike($(a[t]),pclnPicMe.resultset[t])},pclnPicMe.resultset&&setTimeout(function(){pclnPicMe.lazyLoad()},1e3)}(),pclnPicMe.likesEventHandler=function(){function e(e){e.find(".modal--details__like-content img").click(function(){var i=e.find(".modal--details__container").attr("data-id");n(i,e.find(".details--modal__like-count"),!0)})}function n(e,n,i){var a={url:"/api/like/"+e,type:"GET",success:function(a){a.message||(n.text(a.likes.length),pclnPicMe.updateLocalLikes(e,a,i))}};$.ajax(a)}return $("#image-list").on("click",".submissions__icon-container",function(){var e=$(this),i=e.closest(".submissions__img-container").find(".submissions__img").attr("data-id");n(i,e.siblings(".like-value"))}),{addLikeEvent:e}}(),pclnPicMe.uploadEventHandler=function(){function e(e,n){var i=e.find("form"),a=i.find('input[type="file"]'),t=n.find(".modal--sm__button--confirm"),d=n.find("#terms-link"),r=n.find(".modal--sm__button--cancel"),s=n.find(".modal__close"),u=!1;i.submit(function(p){p.preventDefault(),pclnPicMe.unbindClickEvents([t,r,s,d,n]);var f=new FormData(this);return f.append("datetime",Date.now()),o&&f.append(a.attr("name"),o),!!pclnPicMe.isValidForm(i,c,o,!0)&&(e.hide(),t.click(function(){if(!u){var e=$(this).find(".loader--white");e.removeClass("ishidden"),u=!0;var a={url:"/api/upload",type:"POST",data:f,contentType:!1,processData:!1,success:function(a){u=!1,a.error?(alert(a.error),l(i),e.addClass("ishidden"),n.hide()):pclnPicMe.redirectHome()},error:function(){u=!1,l(i),e.addClass("ishidden"),n.hide()}};$.ajax(a)}}),d.click(function(e){e.preventDefault(),n.find(".modal--smal__text").toggle()}),r.click(function(){e.show(),n.hide()}),s.click(function(){e.show(),n.hide()}),n.click(function(i){var a=$(i.target);a.is(".modal-overlay")&&(e.show(),n.hide())}),n.find(".modal--smal__text").hide(),n.show(),!1)})}function n(e){var n=e.find(".drag-n-drop");n.on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("dragover dragenter",function(){e.addClass("is-dragover")}).on("dragleave dragend drop",function(){e.removeClass("is-dragover")}).on("drop",a(e)),n.click(function(){e.find("#file").trigger("click")})}function i(e){var n=e.find("#file");n.change(a(e))}function a(e){function n(n){var i,a=n.originalEvent.dataTransfer;a?(o=n.originalEvent.dataTransfer.files[0],i=o,e.find("#file").val(""),e.trigger("change")):(i=n.currentTarget.files[0],o=!1);var t=new FileReader;t.onload=function(n){e.find("img#preview").attr("src",n.target.result)},t.readAsDataURL(i)}return n}function t(e){function n(){$("body").css("overflow-y",""),e.hide(),l(e.find("form"))}var i=e.find("#upload-modal-close");i.click(n),e.click(function(e){var i=$(e.target);i.is(".modal-overlay")&&n()})}function d(e){e.change(function(){pclnPicMe.isValidForm(e,c,o)}),e.find('input[name="location"]').keyup(function(){pclnPicMe.isValidForm(e,c,o)})}function l(e){e[0].reset(),e.find("img#preview").attr("src",""),e.find('button[type="submit"]').addClass("disabled"),e.parent().find(".modal--lg__error-message").addClass("ishidden"),o=!1}var o=!1,c={map:["#image-error","#category-error","#location-error"],image:function(e){if(!(e&&e.length>0||o))return this.map[0]},"category[]":function(e){if(!(e&&e.length>0))return this.map[1]},location:function(e){if(!(e&&e.length>0))return this.map[2]}};return{addSubmitEvent:e,addDragAndDropCapabilities:n,addImagePreviewEvent:i,addCloseEvent:t,addValidationEvent:d}}(),pclnPicMe.updateEventHandler=function(){function e(e){e.submit(function(n){n.preventDefault(),$("<input />").attr("type","hidden").attr("name","uniquename").attr("value",$(this).attr("data-id")).appendTo(this);var i=(new FormData(this),$(this).serializeArray()),a=$(this).find('button[type="submit"] .loader--white');if(!pclnPicMe.isValidForm(e,d,"no-image",!0))return!1;a.removeClass("ishidden");var t={url:"/api/update",type:"POST",data:i,success:function(e){e.error?(alert(e.error),a.addClass("ishidden")):pclnPicMe.redirectHome()}};return $.ajax(t),!1})}function n(e){function n(){$("body").css("overflow-y",""),e.hide()}var i=e.find("#update-modal-close");i.click(n),e.click(function(e){var i=$(e.target);i.is(".modal-overlay")&&n()})}function i(e,n){var i=e.find(".delete"),a=n.find(".modal--sm__button--confirm"),t=n.find(".modal--sm__button--cancel"),d=n.find(".modal__close");i.click(function(e){e.preventDefault(),pclnPicMe.unbindClickEvents([a,t,d,n]),a.click(function(){var e=$(this).find(".loader--white");e.removeClass("ishidden");var n={url:"/api/remove/"+l.uniqueName,type:"GET",success:function(n){n.error?(alert(n.error),e.addClass("ishidden")):pclnPicMe.redirectHome()}};$.ajax(n)}),t.click(function(){n.hide()}),d.click(function(){n.hide()}),n.click(function(e){var i=$(e.target);i.is(".modal-overlay")&&n.hide()}),n.show()})}function a(e){e.change(function(){pclnPicMe.isValidForm(e,d,"no-image")})}function t(e,n){var i=e.find("form");l=n,i[0].reset(),i.attr("data-id",l.uniqueName),e.find(".modal--lg__img-preview").attr("src",l.thumbUrl),e.find(".modal--lg__input").val(l.location),l.tags.forEach(function(n){e.find("#update-"+n).prop("checked",!0)})}var d={map:["#update-category-error","#update-location-error"],"category[]":function(e){if(!(e&&e.length>0))return this.map[0]},location:function(e){if(!(e&&e.length>0))return this.map[1]}},l={};return{addCloseEvent:n,populateUpdateModal:t,addSubmitEvent:e,addDeleteEvent:i,addValidationEvent:a}}(),pclnPicMe.detailsEventHandler=function(){function e(e){function n(){$("body").css("overflow-y",""),e.hide()}var i=e.find("#details-modal-close");i.click(n),e.click(function(e){var i=$(e.target);i.is(".modal-overlay")&&n()})}function n(e){e.find(".modal--details__arrow-right").click(function(){var n=a+1;n<pclnPicMe.resultset.length&&i(e,pclnPicMe.resultset[n]),a=n}),e.find(".modal--details__arrow-left").click(function(){var n=a-1;n>=0&&i(e,pclnPicMe.resultset[n]),a=n})}function i(e,n){var i=e.find(".modal--details__img-categories"),t=e.find(".modal--details__edit"),d=e.find(".modal--details__download");i.empty(),pclnPicMe.setLike(e.find(".modal--details__icon-container"),n),e.find(".modal--details__img").attr("src",n.detailsUrl),e.find(".details--modal__like-count").text(n.likesCount),e.find(".modal--details__container").attr("data-id",n.uniqueName),e.find(".modal--details__img-submitter").text(n.username),e.find(".modal--details__arrow-left").toggleClass("ishidden",0==n.index),e.find(".modal--details__arrow-right").toggleClass("ishidden",n.index==pclnPicMe.resultset.length-1),pclnPicMe.uid==n.uid||n.downloadUrl?n.downloadUrl&&t.show():t.hide(),n.downloadUrl?(d.attr("href",n.downloadUrl),d.show()):d.hide(),n.tags.forEach(function(e){i.append('<span class="modal--details__category">#'+pclnPicMe.tagDictionary[e]+"</span>")}),a=n.index}var a=0;return{addCloseEvent:e,addShiftEvents:n,populateDetailsModal:i}}(),function(){function e(e){e.find(".modal--details__edit").click(function(a){a.preventDefault(),e.hide();var t=$(a.currentTarget),d=$("#update-modal"),l=$("#delete-confirm"),o=pclnPicMe.resultset.find(function(e){return e.uniqueName==t.parents(".modal--details__container").attr("data-id")});if(d.length<1){d=n("update-modal");var c=d.find("form");pclnPicMe.updateEventHandler.addCloseEvent(d),pclnPicMe.updateEventHandler.addSubmitEvent(c),pclnPicMe.updateEventHandler.addValidationEvent(c),l.length<1&&(l=n("delete-confirm")),pclnPicMe.updateEventHandler.addDeleteEvent(c,l),i(d,{updateImageData:o})}else i(d,{updateImageData:o})})}function n(e){for(var n=$("template").html().trim(),i=$(n),t=[],d=0;d<i.length;d++)"#text"!=i[d].nodeName&&t.push(i[d]);var l=a[e],o=$(t[l]);return o.appendTo("body")}function i(e,n){n&&n.detailsImageData?pclnPicMe.detailsEventHandler.populateDetailsModal(e,n.detailsImageData):n&&n.updateImageData&&pclnPicMe.updateEventHandler.populateUpdateModal(e,n.updateImageData),$("body").css("overflow-y","hidden"),e.show()}var a={"upload-modal":0,"upload-success":1,"delete-confirm":2,"update-modal":3,"details-modal":4,"accept-terms":5};$("#upload-image").click(function(e){var a=$("#upload-modal");if(a.length<1){a=n("upload-modal");var t=a.find("form"),d=$("#accept-terms");pclnPicMe.supportsDragAndDrop&&pclnPicMe.uploadEventHandler.addDragAndDropCapabilities(t),d.length<1&&(d=n("accept-terms")),pclnPicMe.uploadEventHandler.addCloseEvent(a),pclnPicMe.uploadEventHandler.addImagePreviewEvent(t),pclnPicMe.uploadEventHandler.addSubmitEvent(a,d),pclnPicMe.uploadEventHandler.addValidationEvent(t),i(a)}else i(a)}),$("#delete-image").click(function(e){n("delete-confirm")}),$("#image-list").on("click",".submissions__img",function(){var a=$(this),t=$("#details-modal"),d=pclnPicMe.resultset.find(function(e){return e.uniqueName==a.attr("data-id")});t.length<1?(t=n("details-modal"),pclnPicMe.detailsEventHandler.addCloseEvent(t),pclnPicMe.detailsEventHandler.addShiftEvents(t),pclnPicMe.likesEventHandler.addLikeEvent(t),e(t),i(t,{detailsImageData:d})):i(t,{detailsImageData:d})})}(),function(){function e(){var e=pclnPicMe.getParameterByName("tag")||"all",n=$('.sidebar__categories_input[name="user"]');if($(".sidebar__categories_input").prop("checked",!1),e&&e.trim().length>0&&n.length<1){var i=$('.sidebar__categories_input[value="'+e+'"]');i.prop("checked",!0),i.next().addClass("checkedtag"),$(".main-filters-list").append("<span>: "+i.next().text().replace("#","")+"</span>")}else n.length>0&&(n.prop("checked",!0),n.next().addClass("checkedtag"),$(".main-filters-list").append("<span>: "+n.val().replace("."," ")+"</span>"))}e(),$(".submissions__sort").change(function(e){var n=pclnPicMe.updateQueryStringParameter(window.location.href,"sort",$(this).find("option:selected").val());window.location.href=n}),$(".sidebar__categories_input").change(function(){var e,n=$('.sidebar__categories_input[name="category[]"]:checked'),i=pclnPicMe.updateQueryStringParameter(window.location.href,"tag",n.val());e=i.indexOf("user")>-1?pclnPicMe.updateQueryStringParameter(i,"user",""):i,window.location.href=e}),$(".submissions__username a").click(function(e){e.preventDefault();var n,i=pclnPicMe.updateQueryStringParameter(window.location.href,"user",$(this).text().replace(" ","."));n=i.indexOf("tag")>-1?pclnPicMe.updateQueryStringParameter(i,"tag",""):i,window.location.href=n})}(),function(){function e(e){var n='<li class="submissions__img-container" data-uid="'+e.uid+'"><img class="submissions__img" data-id="'+e.id+'" src=""><div class="submission__info"><span class="submissions__username"><a href="">'+e.username+'</a></span><span class="submissions__icon-container"><img class="submissions__like-icon" src="/images/hand.svg"/></span>Likes: <span class="like-value">'+e.likesCount+"</span></span></div></li>";return n}var n=1,i=pageSize=pclnPicMe.pageSize,a=!0,t=!1;$(window).scroll(function(){var d=$(window).scrollTop()+$(window).height()>$(document).height()-200,l="mypics"==pclnPicMe.scrollType,o=window.location.search.length>0?"&uid="+pclnPicMe.uid:"?uid="+pclnPicMe.uid,c="/api/fetchPosts/"+n+window.location.search,r=$(".pageloader");if(d&&a&&!t){l&&(c+=o),r.show();var s={url:c,type:"GET",success:function(d){i=n*pageSize,a=i<d.totalPostCount,t=!1,r.hide(),n++,d.images.length>0&&(pclnPicMe.resultset=pclnPicMe.resultset.concat(d.images),d.images.forEach(function(n){$(e(n)).appendTo("#image-list")}),pclnPicMe.lazyLoad(i))}};t=!0,$.ajax(s)}})}();